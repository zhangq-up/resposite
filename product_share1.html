<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>郑州银行分享页面</title>
	</head>
	<style type="text/css">
		.btn {
			text-align: center;
			margin-top: 300px;
		}
		
		.btn-span {
			display: inline-block;
			padding: 20px 100px;
			background: orange;
			border-radius: 40px;
			font-size: 36px;
		}
	</style>

	<body>
		<div>
			<div class="btn">
				<a id="openApp" href="javascript:;" title="">立即打开</a>
			</div>
		</div>
	</body>
	<script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
	<script type="text/javascript">
		(function(window) {
			var ue = {};

			// 客户端检测
			ue.browserInfo = function() {
				var json = {
					userAgent: navigator.userAgent.toLowerCase(),
					isAndroid: Boolean(navigator.userAgent.match(/android/ig)),
					isIos: Boolean(navigator.userAgent.match(/iphone|ipod|ipad/ig)),
					isWeChat: Boolean(navigator.userAgent.match(/MicroMessenger/ig)),
					isQQ: Boolean(navigator.userAgent.match(/ QQ/ig)),
					isQQBrowser: Boolean(navigator.userAgent.match(/MQQBrowser/ig))
				}

				return json;
			}

			// 唤醒APP
			ue.openApp = function() {
				var $btnOpenIos = $('#downloadIos');
				var browser = ue.browserInfo();
				var scheme = "zzbk://zz_financial/financial/financial_detail.html" + window.location.search;
				var iosVersion = browser.userAgent.match(/os\s*(\d+)/);
				var universalLink = "https://apps.apple.com/cn/app/id571831520";

				iosVersion = iosVersion ? (iosVersion[1] || 0) : 0;

//				if(browser.isAndroid) { // 安卓
//					scheme = 'b';
//				} else if(browser.isIos) { // ios
//					scheme = 'c';
//				}

				$btnOpenIos.on('click', function() {
					//客户端检测微信
					if(browser.isWeChat) {
						alert('微信请跳转其他浏览器打开页面')
					} else {
						if(browser.isAndroid) {
							var ifr = document.createElement('iframe');
							ifr.src = scheme;
							ifr.style.display = 'none';
							document.body.appendChild(ifr);

							setTimeout(function() {
								document.body.removeChild(ifr);
							}, 2000);
						} else {
							// ios9+
							if(iosVersion >= 9) {
								document.location.href = universalLink;
							} else {
								setTimeout(function() { // 必须要使用settimeout
									var a = document.createElement("a"); //创建a元素
									a.setAttribute("href", scheme), a.style.display = "none", document.body.appendChild(a);
									var t = document.createEvent("HTMLEvents"); // 返回新创建的 Event 对象，具有指定的类型。
									t.initEvent("click", !1, !1) // 初始化新事件对象的属性
									a.dispatchEvent(t) // 绑定事件
								}, 0)
							}
						}

						var checkOpen = function(cb) {
							var _clickTime = +(new Date());

							function check(elsTime) {
								if(elsTime > 3000 || document.hidden || document.webkitHidden) {
									cb(1);
								} else {
									cb(0);
								}
							}
							//启动间隔20ms运行的定时器，并检测累计消耗时间是否超过3000ms，超过则结束
							var _count = 0,
								intHandle;
							intHandle = setInterval(function() {
								_count++;
								var elsTime = +(new Date()) - _clickTime;
								if(_count >= 100 || elsTime > 3000) {
									clearInterval(intHandle);
									check(elsTime);
								}
							}, 20);
						}
						checkOpen(function(opened) {
							// APP没有打开成功  并且开启自动跳转到下载页
							if(opened === 0) {
								if(browser.isAndroid) { // 安卓
									"https://sj.qq.com/myapp/detail.htm?apkName=com.zzbank.mobile.bank"
								} else if(browser.isIos) { // ios
									location.href = universalLink
								}
							}
						});
					}
					ue.trackEventDownload();
				});
			};

			ue.init = function() {
				ue.openApp();
			};
		})(window);
		$(function() {
			ue.init();
		})
	</script>

</html>